<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>Gemini API è¯Šæ–­å·¥å…· (No-CDN Version)</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 600px;
            width: 100%;
            border: 1px solid #444;
            padding: 20px;
            border-radius: 8px;
            background-color: #2d2d2d;
        }

        h1 {
            margin-top: 0;
            color: #60a5fa;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 14px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #555;
            background: #000;
            color: #0f0;
            font-family: monospace;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 15px;
        }

        button:hover {
            background-color: #1d4ed8;
        }

        #log {
            width: 100%;
            height: 200px;
            background: #000;
            border: 1px solid #555;
            padding: 10px;
            font-family: monospace;
            color: #0f0;
            white-space: pre-wrap;
            overflow-y: auto;
            box-sizing: border-box;
            border-radius: 4px;
        }

        .status-ok {
            color: #4ade80;
        }

        .status-err {
            color: #f87171;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ› ï¸ Gemini API è¿æ¥æµ‹è¯•</h1>

        <div>
            <label>API Key (è‡ªåŠ¨è¯»å–ï¼Œå¦‚ä¸ºç©ºè¯·æ‰‹åŠ¨ç²˜è´´):</label>
            <input type="text" id="api-key-input" placeholder="Paste your API Key here if empty...">
        </div>

        <button onclick="startTest()">ğŸ‘‰ ç‚¹å‡»å¼€å§‹æµ‹è¯• (Run Test)</button>

        <label>æµ‹è¯•æ—¥å¿—:</label>
        <div id="log">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <script>
        // Auto-load key
        const savedKey = localStorage.getItem('tds_gemini_api_key');
        const inputEl = document.getElementById('api-key-input');
        const logEl = document.getElementById('log');

        if (savedKey) {
            inputEl.value = savedKey;
            log('å·²ä»æœ¬åœ°ç¼“å­˜è¯»å– API Keyã€‚');
        } else {
            log('æœªæ‰¾åˆ°æœ¬åœ° Keyï¼Œè¯·æ‰‹åŠ¨ç²˜è´´ã€‚');
        }

        function log(msg) {
            logEl.innerText += '\n' + msg;
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function startTest() {
            const key = inputEl.value.trim();
            if (!key) return log('âŒ é”™è¯¯: API Key ä¸ºç©ºï¼');

            log('-----------------------------------');
            log('å¼€å§‹æµ‹è¯• Gemini 1.5 Flash...');

            // Explicit 1.5 Flash URL
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
            log(`è¯·æ±‚åœ°å€: ...${url.split('key=')[0]}...`);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "Respond with 'OK'." }] }]
                    })
                });

                log(`HTTP çŠ¶æ€ç : ${response.status}`);

                if (response.ok) {
                    const data = await response.json();
                    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    log(`âœ… æµ‹è¯•æˆåŠŸ! API è¿”å›: "${reply?.trim()}"`);
                    log(`ç»“è®º: æ‚¨çš„ç½‘ç»œå’Œ Key å‡æ­£å¸¸ã€‚é—®é¢˜åœ¨äºæµè§ˆå™¨ç¼“å­˜ï¼Œè¯·å¼ºåˆ¶åˆ·æ–°ä¸»é¡µé¢ (Ctrl+F5)ã€‚`);
                } else {
                    const err = await response.json();
                    log(`âŒ API æŠ¥é”™: ${JSON.stringify(err, null, 2)}`);
                    if (response.status === 404) log('åˆ†æ: 404 è¡¨ç¤ºæ¨¡å‹åç§°é”™è¯¯æˆ– API è·¯ç”±ä¸é€šã€‚');
                    if (response.status === 429) log('åˆ†æ: 429 è¡¨ç¤º Key é™æµã€‚');
                    if (response.status === 403) log('åˆ†æ: 403 è¡¨ç¤º Key æ— æ•ˆæˆ–æƒé™ä¸è¶³ã€‚');
                }

            } catch (e) {
                log(`âŒ ç½‘ç»œè¯·æ±‚å¼‚å¸¸: ${e.message}`);
                log('å¯èƒ½æœ‰ç½‘ç»œé˜²ç«å¢™æ‹¦æˆª googleapis.comã€‚');
            }
        }
    </script>
</body>

</html>